using System;

namespace Vereyon.Web;

public static class HtmlSanitizerGroupFluentHelper
{
    public record HtmlSanitizerTagRules(IReadOnlyCollection<HtmlSanitizerTagRule> RuleList);
    public static HtmlSanitizerTagRules Tags(this HtmlSanitizer sanitizer, params ReadOnlySpan<string> tagNames)
    {
        var list = new List<HtmlSanitizerTagRule>(tagNames.Length);
        foreach (var tagName in tagNames)
        {
            list.Add(sanitizer.Tag(tagName));
        }
        return new HtmlSanitizerTagRules(list);
    }

    public static HtmlSanitizerTagRules Flatten(this HtmlSanitizerTagRules rules)
    {
        foreach (var rule in rules.RuleList)
        {
            rule.Flatten();
        }
        return rules;
    }

    public static HtmlSanitizerTagRules RemoveEmpty(this HtmlSanitizerTagRules rules)
    {
        foreach (var rule in rules.RuleList)
        {
            _ = rule.RemoveEmpty();
        }
        return rules;
    }

    public static HtmlSanitizerTagRules Rename(this HtmlSanitizerTagRules rules, string newName)
    {
        foreach (var rule in rules.RuleList)
        {
            rule.RenameTag = newName;
        }
        return rules;
    }

    public static HtmlSanitizerTagRules Sanitize(this HtmlSanitizerTagRules rules, IHtmlElementSanitizer elementSanitizer)
    {
        foreach (var rule in rules.RuleList)
        {
            rule.ElementChecks.Add(elementSanitizer);
        }
        return rules;
    }

    public static HtmlSanitizerTagRules NoAttributes(this HtmlSanitizerTagRules rules, SanitizerOperation operation)
    {
        foreach (var rule in rules.RuleList)
        {
            rule.NoAttributesOperation = operation;
        }
        return rules;
    }

    public static HtmlSanitizerTagRules Operation(this HtmlSanitizerTagRules rules, SanitizerOperation operation)
    {
        foreach (var rule in rules.RuleList)
        {
            rule.Operation = operation;
        }
        return rules;
    }

    public static void Remove(this HtmlSanitizerTagRules rules)
    {
        foreach (var rule in rules.RuleList)
        {
            rule.Operation = SanitizerOperation.RemoveTag;
        }
    }
}
